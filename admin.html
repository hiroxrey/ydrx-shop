<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>YDRX | Admin</title>

<style>
/* === MISMO ESTILO QUE DASHBOARD === */
:root{
  --bg:#050608;
  --neon:#29ff6a;
  --text:#e8fff1;
  --muted:#a8d6b8;
  --card: rgba(0,0,0,.55);
  --border: rgba(41,255,106,.55);
  --shadow: 0 0 12px rgba(41,255,106,.55), 0 0 28px rgba(41,255,106,.35);
}
*{box-sizing:border-box}
body{
  margin:0; padding:16px;
  background:var(--bg);
  color:var(--text);
  font-family: system-ui, sans-serif;
}
.box{
  max-width:1100px;
  margin:auto;
  background:var(--card);
  border:1px solid var(--border);
  border-radius:16px;
  padding:14px;
  box-shadow:var(--shadow);
}
.row{display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between}
.grid{display:grid; gap:10px}
.card{
  border:1px solid var(--border);
  border-radius:14px;
  padding:12px;
  background:rgba(0,0,0,.45);
}
button,input,select,textarea{
  padding:10px 12px;
  border-radius:12px;
  border:1.5px solid var(--border);
  background:rgba(0,0,0,.45);
  color:var(--text);
}
button{cursor:pointer}
button:hover{background:rgba(41,255,106,.2)}
.muted{opacity:.75}
pre{
  background:#000;
  padding:10px;
  border-radius:10px;
  border:1px solid var(--border);
}
hr{border:0;border-top:1px solid rgba(41,255,106,.2)}
.small{font-size:12px}
.danger{border-color:#ff5a5a;color:#ffbcbc}
.ok{border-color:#29ff6a}
</style>
</head>

<body>

<div class="box">
  <div class="row">
    <div>
      <b>Panel Admin</b>
      <div class="muted" id="who"></div>
    </div>
    <div class="row">
      <button onclick="location.href='dashboard.html'">Dashboard</button>
      <button onclick="YDRX.logout()">Salir</button>
    </div>
  </div>

  <hr>

  <!-- DAR SALDO -->
  <div class="card">
    <b>Dar saldo a usuario</b>
    <div class="row" style="margin-top:8px">
      <input id="saldoUser" placeholder="@user">
      <input id="saldoMonto" type="number" placeholder="Monto">
      <button onclick="darSaldo()">Agregar saldo</button>
    </div>
  </div>

  <hr>

  <!-- CREAR PRODUCTO -->
  <div class="card">
    <b>Crear producto</b>
    <div class="row" style="margin-top:8px">
      <input id="pName" placeholder="Nombre">
      <input id="pPerfil" type="number" placeholder="Precio perfil">
      <input id="pCompleta" type="number" placeholder="Precio completa">
      <button onclick="crearProducto()">Crear</button>
    </div>
  </div>

  <hr>

  <!-- PRODUCTOS -->
  <div id="products" class="grid"></div>

</div>

<script src="app.js"></script>
<script>
/* ====== SEGURIDAD ====== */
const me = YDRX.requireLogin();
if(me.role !== "admin"){
  alert("Solo admin");
  location.href="dashboard.html";
}
document.getElementById("who").textContent = me.user+" ("+me.email+")";

/* ====== SALDO ====== */
function darSaldo(){
  const user = document.getElementById("saldoUser").value.trim();
  const monto = Number(document.getElementById("saldoMonto").value);
  const db = YDRX.loadDB();
  const u = db.users.find(x=>x.user===user);
  if(!u) return alert("Usuario no existe");
  u.balance += monto;
  YDRX.saveDB(db);
  alert("Saldo agregado");
}

/* ====== PRODUCTOS ====== */
function crearProducto(){
  YDRX.addProduct({
    name:pName.value,
    perfilPrice:pPerfil.value,
    completaPrice:pCompleta.value
  });
  render();
}

function render(){
  const db = YDRX.loadDB();
  const wrap = document.getElementById("products");
  wrap.innerHTML="";

  db.products.forEach(p=>{
    const c = document.createElement("div");
    c.className="card";
    c.innerHTML=`
      <b>${p.name}</b>
      <div class="small muted">Activo: ${p.active}</div>

      <div class="row small">
        Perfil $${p.variants.perfil.price} | Stock ${p.variants.perfil.stock.length}
        <button onclick="toggle('${p.id}')">ON/OFF</button>
      </div>

      <div class="row small">
        Completa $${p.variants.completa.price} | Stock ${p.variants.completa.stock.length}
      </div>

      <hr>

      <b>Agregar stock</b>
      <select id="v_${p.id}">
        <option value="perfil">perfil</option>
        <option value="completa">completa</option>
      </select>
      <textarea id="s_${p.id}" placeholder="1 cuenta por lÃ­nea"></textarea>
      <button onclick="addStock('${p.id}')">Subir stock</button>

      <hr>
      <b>Eliminar stock individual</b>
      ${renderStock(p)}
    `;
    wrap.appendChild(c);
  });
}

function toggle(id){
  const db = YDRX.loadDB();
  const p = db.products.find(x=>x.id===id);
  p.active = !p.active;
  YDRX.saveDB(db);
  render();
}

function addStock(id){
  const variant = document.getElementById("v_"+id).value;
  const items = document.getElementById("s_"+id).value.split("\n");
  YDRX.addStock(id, variant, items);
  render();
}

function renderStock(p){
  let html="";
  ["perfil","completa"].forEach(v=>{
    p.variants[v].stock.forEach((s,i)=>{
      html+=`
        <div class="row small">
          <span>${v}: ${s}</span>
          <button class="danger" onclick="delStock('${p.id}','${v}',${i})">X</button>
        </div>
      `;
    });
  });
  return html || "<div class='muted small'>Sin stock</div>";
}

function delStock(pid,v,i){
  const db = YDRX.loadDB();
  db.products.find(p=>p.id===pid).variants[v].stock.splice(i,1);
  YDRX.saveDB(db);
  render();
}

render();
</script>
</body>
</html>
