<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>YDRX | Registro</title>

  <style>
    :root{
      --bg:#050608;
      --neon:#29ff6a;
      --neon2:#7CFFB1;
      --text:#e8fff1;
      --muted:#a8d6b8;
      --shadow: 0 0 12px rgba(41,255,106,.55),
                0 0 28px rgba(41,255,106,.35),
                0 0 60px rgba(41,255,106,.18);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background: var(--bg);
      color: var(--text);
      overflow:hidden;
    }
    canvas#space{position:fixed; inset:0; width:100%; height:100%; z-index:0;}
    .wrap{position:relative; z-index:1; min-height:100%; display:flex; align-items:center; justify-content:center; padding:28px 16px;}
    .brand{
      position:absolute; top:22px; left:50%; transform:translateX(-50%);
      letter-spacing:.25em; font-weight:900;
      font-size:clamp(24px,4vw,44px);
      text-transform:uppercase;
      text-shadow:0 0 10px rgba(41,255,106,.6),0 0 30px rgba(41,255,106,.35);
    }
    .card{
      width:min(520px,92vw);
      padding:26px 22px;
      border-radius:18px;
      background:rgba(0,0,0,.55);
      backdrop-filter:blur(10px);
      border:1.5px solid rgba(41,255,106,.55);
      box-shadow:var(--shadow);
    }
    .headline{font-size:22px;font-weight:800}
    .sub{color:var(--muted);font-size:14px;margin-bottom:18px}
    .form{display:grid;gap:12px}
    .grid2{display:grid;gap:12px;grid-template-columns:1fr 1fr}
    @media(max-width:520px){.grid2{grid-template-columns:1fr}}
    label{font-size:12px}
    input{
      width:100%;padding:12px;border-radius:14px;
      background:rgba(0,0,0,.45);color:var(--text);
      border:1.5px solid rgba(41,255,106,.35)
    }
    .btn{
      padding:13px;border-radius:14px;font-weight:900;
      border:1.5px solid rgba(41,255,106,.85);
      background:rgba(41,255,106,.18);color:var(--text);
      cursor:pointer
    }
    .btn:disabled{opacity:.5}
    .status{display:none;font-size:12px;padding:10px;border-radius:12px}
    .status.show{display:block}
    .status.bad{border:1px solid #ff5a5a}
    .status.good{border:1px solid #29ff6a}
  </style>
</head>

<body>
<canvas id="space"></canvas>

<div class="wrap">
  <div class="brand">YDRX</div>

  <section class="card">
    <h1 class="headline">Crear cuenta</h1>
    <p class="sub">Regístrate para comprar con saldo.</p>

    <form id="registerForm" class="form">
      <div>
        <label>Correo</label>
        <input id="email" type="email" required>
      </div>

      <div>
        <label>@user</label>
        <input id="user" required>
      </div>

      <div class="grid2">
        <input id="pass" type="password" placeholder="Contraseña" required>
        <input id="pass2" type="password" placeholder="Confirmar" required>
      </div>

      <div id="status" class="status"></div>

      <button class="btn" id="submitBtn">Crear cuenta</button>
    </form>
  </section>
</div>

<!-- ✅ Supabase SOLO UNA VEZ -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="supabase.js"></script>

<script>
/* ---------- Registro ---------- */
const statusEl = document.getElementById("status");
const btn = document.getElementById("submitBtn");

function setStatus(msg,type){
  statusEl.textContent = msg;
  statusEl.className = "status show " + type;
}

document.getElementById("registerForm").addEventListener("submit", async e=>{
  e.preventDefault();

  const email = email.value.trim();
  const user = userEl = document.getElementById("user").value.trim();
  const p1 = pass.value;
  const p2 = pass2.value;

  if(p1!==p2) return setStatus("Contraseñas no coinciden","bad");

  btn.disabled=true;
  setStatus("Creando cuenta...","good");

  const { error } = await supabase.auth.signUp({
    email,
    password:p1,
    options:{ data:{ user } }
  });

  if(error){
    btn.disabled=false;
    return setStatus(error.message,"bad");
  }

  setStatus("Cuenta creada. Revisa tu correo.","good");
  setTimeout(()=>location.href="login.html",1500);
});
</script>
</body>
</html>
